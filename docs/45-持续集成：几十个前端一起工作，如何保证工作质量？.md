### 持续集成

#### 持续集成总论
传统软件的持续集成主要有以下措施：
* daily build：每日构建，开发者每天提交代码到代码仓库，构建一个可运行的版本。
* build verification test（BVT）：构建验证测试，每日构建版本出来后，运行一组自动化的测试用例，保证基本功能可用。

对于前端来说，有一些现实的区别：
* 前端代码按页面自然解耦，大部分页面都是单人开发；
* 前端构建逻辑简单，一般开发阶段都保证构建成功，不需要构建；
* 前端代码一般用于开发界面，测试自动化成本极高；
* 前端页面跳转，是基于url，没有明确的产品边界。
因此我们不用套用传统的持续集成理论，而需要重新思考前端领域的持续集成体系。

##### 持续集成的目标
持续集成的根本理念，一是要及早集成代码形成可测试的版本，二是通过一定的测试来验证提交的代码的有效性。

##### 持续集成的方案
前端的持续集成的措施应该是这样的：
* 预览环境，代替每日构建，前端每次（或指定次）提交代码到仓库都同步到预览环境，保证预览环境总是可用；
* 规则校验，代替构建验证测试，通过数据采集（如前面提到的性能数据）和代码扫描，保证提交的代码满足一定的质量要求。

##### 预览环境
预览环境的部署和发布机制建立是最基本的需求，在实际应用中，情况要复杂的多，可能需要多个预览环境同时存在。

比如，测试工程师可能要求一个相对稳定的环境来测试，这是一个合理的诉求，比如，全公司大部分业务都可能依赖登录页面，一旦登录页面在频繁发布导致一些预览环境的故障，可能全公司都没办法工作了。

又比如，当服务端工程师联调时，会希望前端的预览环境跟服务端的预览环境对接，而当服务端的代码部署到线上生产环境后，可能又需要前端的预览环境跟服务端线上环境对接。

应该设计一套带参数和版本号的预览环境，为测试提供特定版本的预览环境，用参数解决那些跟服务端API对接问题

##### 规则校验
规则校验可以分成三种措施：
* 页面结构扫描；
* 运行时数据采集；
* 代码扫描。

页面结构扫描可以使用无头浏览器（如phantomjs）配合一些JavaScript代码编写的规则来完成。
运行时数据采集，可以通过在页面插入公共js文件的方式来完成，最基本的是用Performance API来采集性能数据，用window.onerror来采集js错误。
代码扫描，社区有一些现成的方案，比如JSHint

##### 持续集成的实施
持续集成的实施，是必须严格做到自动化和制度化的。
我们刚刚讲解的规则校验仅仅是搭建好了平台，而规则本身，我们需要先形成一个共识，然后在前端团队内部形成一定的更新机制。
用issue的方式来管理规则的提案，可以在周会或者月会上讨论，充分保证整个团队对校验规则的一致意见。

##### 持续集成的结果
持续集成机制的建立本身就可以视为一种结果，它能够让整个团队的代码质量有一个基本的保障，提前发现问题，统一代码风格，从而带来开发体验和效率的提升。

此外，持续集成的结果也能够以数据的方式呈现出整个开发团队的健康状态，这是管理者会非常关注的一个点。
